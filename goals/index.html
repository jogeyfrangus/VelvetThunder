<!DOCTYPE html>
<html lang="en">

<head>
    <title>Goals</title>
    <link rel="stylesheet" href="goals.css">
</head>

<body>

<h1>Goal Logging</h1>
<p>Please enter your goal for today, in litres.</p>
<input type="text" id="goalInput">
<input type="button" id="goalInputConfirm" value="Submit Goal">

<!-- Standard Firebase Content -->
<script src="https://www.gstatic.com/firebasejs/7.2.3/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/7.2.3/firebase-firestore.js"></script>
<script src="https://www.gstatic.com/firebasejs/7.2.3/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/7.2.3/firebase-analytics.js"></script>
<script src="https://velvetthunder.firebaseapp.com/customFirebase.js"></script>
<script src="https://cdn.firebase.com/libs/firebaseui/3.5.2/firebaseui.js"></script>
<link type="text/css" rel="stylesheet" href="https://cdn.firebase.com/libs/firebaseui/3.5.2/firebaseui.css" />
<!-- End Standard Firebase Content -->


<script>
    let goalInput = document.getElementById("goalInput");
    let goalInputConfirm = document.getElementById("goalInputConfirm");

    function currentDate() {
        let today = new Date();
        let dateToday = today.getFullYear() + '-' + (today.getMonth() + 1) + '-' + today.getDate();
        return dateToday.toString();
    }

    function goalCreation(date, newGoalInput) {
        let goalRef = db.collection("Users").doc(currentUser.uid).collection("Goals").doc("Water");
        goalRef.set({ [date]: newGoalInput }, {merge: true})
            .then(function () {
                alert(`Successfully updated goal log for ${date} to ${newGoalInput} litres.`) // Successful log
            })
            .catch(function () {
                alert("Goal log unsuccessful.") // Unsuccessful log
            });
    }

    function createGoal() {
        let userInput = goalInput.value;
        if (!isNaN(userInput)) {
            if (confirm('Are you sure?')) {
                goalCreation(currentDate(), Number(userInput));
            }
        } else {
            alert('Not a valid number.')
        }
    }

    goalInputConfirm.onclick = createGoal;
</script>

</body>

</html>
